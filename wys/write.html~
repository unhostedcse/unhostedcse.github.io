<html lang="en-US"><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">

  <!-- <meta content="IE=EmulateIE10" http-equiv="X-UA-Compatible"> -->


  <link href="./js/mime.css" rel="stylesheet" type="text/css">
  <link href="./js/screen_002.css" rel="stylesheet" type="text/css">
  <link href="./js/screen_003.css" rel="stylesheet" type="text/css">
  <link href="./js/screen.css" rel="stylesheet" type="text/css">
  <link href="./js/mozilla.css" rel="stylesheet" type="text/css">
  <link type="image/x-icon" href="http://cse.rukspot.com/horde/imp/themes/default/graphics/favicon.ico" rel="shortcut icon">    
  <title>Mail :: New Message</title>
 </head>

 <body class="horde-ajax">
<div style="display:none">
 <span id="largeaddrspan">
  <span class="largeaddrtoggle">
   <span class="largeaddrlist">Show Addresses (%d)</span>
   <span class="largeaddrlist" style="display:none">Hide Addresses</span>
  </span>
  <span class="dispaddrlist" style="display:none">
   <span class="largeaddrlistlimit" style="display:none">Load All Addresses</span>
  </span>
 </span>
</div>

<div style="display: none;" id="dimpLoading">
 Loading...</div>

<div id="composeContainer" style="">
 <form target="submit_frame" id="compose" name="compose" enctype="multipart/form-data" action="/horde/services/ajax.php/imp/addAttachment" method="post" style="">
 <input id="html" name="html" value="0" type="hidden"> <input value="tjtSfgoa2Po-OJijX7lyvQ5" id="composeCache" name="composeCache" type="hidden"> <input value="28a8a1cf" id="composeHmac" name="composeHmac" type="hidden"> <input id="request_read_receipt" name="request_read_receipt" value="0" type="hidden"> <input id="user" name="user" value="rukshan" type="hidden"> <input id="save_attachments_select" name="save_attachments_select" value="0" type="hidden"> <input id="MAX_FILE_SIZE" name="MAX_FILE_SIZE" value="2097152" type="hidden"> <input id="vcard_attach" name="vcard_attach" type="hidden">
 <div class="horde-buttonbar">
  <div class="iconImg headercloseimg closeImg" id="compose_close" title="Accesskey Esc"></div>
  <ul>
   <li class="horde-icon">
    <a id="send_button" class="dimpactionForward" title="Accesskey Ctrl-Enter">Send</a>   </li>
   <li class="horde-icon">
    <a id="draft_button" class="dimpactionDrafts" title="Save as Draft">Save as Draft</a>   </li>
  </ul>
 </div>

 <div id="writemsg">
  <div class="msgwrite">
   <div class="dimpOptions">
    <div>
     <label>
     <input class="checkbox" id="htmlcheckbox" name="htmlcheckbox" value="1" type="checkbox">HTML composition     </label>
    </div>
    <div style="">
     <label>
      <input checked="checked" class="checkbox" id="save_sent_mail" name="save_sent_mail" value="1" type="checkbox">Save in      <span title="Sent" id="sent_mail_label">Sent</span>
     </label>
     <span class="iconImg horde-popdown" id="save_sent_mail_load"></span>
     <input value="U2VudA" id="save_sent_mail_mbox" name="save_sent_mail_mbox" type="hidden">    </div>
    <div>
     Priority:<span title="Normal" id="priority_label">Normal</span><span class="iconImg horde-popdown"></span>
     <input id="priority" name="priority" value="normal" type="hidden">    </div>
    <div>
     <span id="other_options">
      <a id="anonymous_element_2">Other Options</a><span id="anonymous_element_3" class="horde-popdown"></span>
     </span>
    </div>
   </div>

   <table>
    <input id="identity" name="identity" value="0" type="hidden">    <tbody><tr id="sendto">
     <td class="label">
      <span class="composeAddrbook">To:</span>
     </td>
      <td>
        <span id="to_loading_img" class="loadingImg" style="display:none"></span>
        <div class="hordeACBox impACBox impACBoxFocus">
          <ul class="hordeACList impACList">
            <li>
              <input style="width: 500px;" class="hordeACTrigger impACTrigger" autocomplete="off">
            </li>
          </ul>
          <textarea style="display: none;" cols="75" id="to" name="to" rows="1"></textarea>
        </div>
      </td>
    </tr>
    <tr id="sendcc" style="display:none">
     <td class="label">
      <span class="composeAddrbook">Cc:</span>
     </td>
     <td>
      <span id="cc_loading_img" class="loadingImg" style="display:none"></span>
      <div class="hordeACBox impACBox impACBoxFocus"><ul class="hordeACList impACList"><li>
        <input style="width: 500px;" class="hordeACTrigger impACTrigger" autocomplete="off"></li></ul>
        <textarea style="display: none;" cols="75" id="cc" name="cc" rows="1"></textarea></div>     </td>
    </tr>
    <tr id="sendbcc" style="display:none">
     <td class="label">
      <span class="composeAddrbook">Bcc:</span>
     </td>
     <td>
      <span id="bcc_loading_img" class="loadingImg" style="display:none"></span>
      <div class="hordeACBox impACBox impACBoxFocus"><ul class="hordeACList impACList"><li>
        <input style="width: 500px;" class="hordeACTrigger impACTrigger" autocomplete="off"></li></ul>
        <textarea style="display: none;" cols="75" id="bcc" name="bcc" rows="1"></textarea></div>     </td>
    </tr>
    <tr>
     <td></td>
     <td>
      <span id="togglecc">Add Cc</span>
      <span id="togglebcc">Add Bcc</span>
     </td>
    </tr>
    <tr>
     <td class="label">Subject:</td>
     <td class="subject">
      <input id="subject" name="subject" type="text">     </td>
    </tr>
    <tr class="atcrow">
     <td class="label">
      <span class="iconImg attachmentImg"></span>:
     </td>
     <td>
      <div id="atcdrop" style="display:none">
       Drop file here to attach.      </div>
      <div id="atcdiv">
       <span id="upload_limit" style="display:none">The attachment limit has been reached.</span>
       <span id="upload_wait" style="display:none"></span>
       <span>
        <label id="compose_upload_add" for="upload">Add Attachment</label>
        <input id="upload" multiple="" name="file_upload[]" type="file"><span id="anonymous_element_1" class="horde-popdown"></span>       </span>
       <ul id="attach_list" style="display:none"></ul>
      </div>
     </td>
    </tr>
    <tr id="noticerow" style="display:none">
     <td colspan="2">
      <ul class="notices">
       <li id="replyallnotice" style="display:none">
        You are <span class="replyAllNoticeUnderline">replying to ALL</span> (<span class="replyAllNoticeCount"></span>).
        <input id="replyall_revert" class="button" value="Reply To Sender instead" type="button">
       </li>
       <li id="replylistnotice" style="display:none">
        You are replying to a mailing list<span class="replyListNoticeId"></span>.
        <input id="replylist_revert" class="button" value="Reply To Sender instead" type="button">
       </li>
       <li id="fwdattachnotice" style="display:none">
        Click this box to add the original message text to the body.       </li>
       <li id="fwdbodynotice" style="display:none">
        Click this box to add the original message as an attachment.       </li>
       <li id="identitychecknotice" style="display:none">
        Your identity has been switched to the identity associated with 
the current recipient address. Click this box to revert to the original 
identity. The identity will not be checked again during this compose 
action.       </li>
       <li id="langnotice" style="display:none">
        The recipient has indicated that they prefer replies in these languages: <span class="langNoticeList"></span>.
       </li>
      </ul>
     </td>
    </tr>
   </tbody></table>
  </div>

  <div id="composeMessageParent">
   <textarea style="height: 43px;" name="message" id="composeMessage" class="fixed">
</textarea>
  </div>

 </div>
</form>
</div>



<script type="text/javascript"  src="ui/jquery-2.1.1.js"></script>

<script type="text/javascript" src="js/prototype.js"></script>
<script type="text/javascript" src="js/horde.js"></script>

 
<!-- <script type="text/javascript" src="UIController.js"></script>    -->


  <script type="text/javascript" src="js/compose-dimp.js"></script>

  <script type="text/javascript" src="js/hordecore.js"></script>
   <script type="text/javascript" src="js/dimpcore.js"></script>
  


  <!---->
  <script type="text/javascript" src="js/viewport_utils.js"></script> 
  <script type="text/javascript" src="js/contextsensitive.js"></script> 
  <script type="text/javascript" src="js/imple.js"></script>
  <script type="text/javascript" src="js/keynavlist.js"></script>
  <script type="text/javascript" src="js/effects.js"></script>
  <script type="text/javascript" src="js/compose-base.js"></script>
  <script type="text/javascript" src="js/imageupload.js"></script>
  <script type="text/javascript" src="js/imagepoll.js"></script>
  
  <script type="text/javascript" src="js/draghandler.js"></script>
  <script type="text/javascript" src="js/editor.js"></script>
  <script type="text/javascript" src="js/imp.js"></script>
  <script type="text/javascript" src="js/autocomplete.js"></script>
  <script type="text/javascript" src="js/liquidmetal.js"></script>
  <script type="text/javascript" src="js/prettyautocomplete.js"></script>
  <script type="text/javascript" src="js/base64.js"></script>
  <script type="text/javascript" src="js/accesskeys.js"></script>
  <script type="text/javascript" src="js/popup.js"></script>
  <script type="text/javascript" src="js/growler.js"></script> 

  <script type="text/javascript" src="js/sound.js"></script>
  <script type="text/javascript" src="js/ckeditor_basic.js"></script>  
  <!-- -->


<script type="text/javascript" src="logger.js"></script>
<script type="text/javascript" src="TCP_Interface.js"></script>
<script type="text/javascript" src="IMAP_Interface.js"></script>
<script type="text/javascript" src="IMAP_Fetch.js"></script>  <!-- -->

<script type="text/javascript" src="SMTP_Interface.js"></script>  <!-- -->
<script type="text/javascript" src="SMTP_Sendmail.js"></script>  <!-- -->

<script type="text/javascript" src="Sync_Module.js"></script>
<script type="text/javascript" src="Mail_Settings.js"></script>
<script type="text/javascript" src="DBController.js"></script>
<!-- <script type="text/javascript" src="UIController.js"></script> -->
<script type="text/javascript" src="BrowserSetUp.js"></script>  

 <script type="text/javascript">
  // alert('ok');
	
$('#composeMessage').htmlarea();

  var db=new DBController();
  db.create_open_account_DB(load);

  function load(){
    var id= parseInt(getParameterByName('id'));
    db.loadAccountById(id);
  }

  function getParameterByName(name) {
    name = name.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]");
    var regex = new RegExp("[\\?&]" + name + "=([^&#]*)"),
        results = regex.exec(location.href);
    return results === null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
}

  var text=document.getElementById('composeMessage').value='Hi, this is test text!';
  var subject=document.getElementById('subject').value='Unhosted subject';
  var data=document.getElementsByClassName('hordeACTrigger impACTrigger');
  //data[0].value='unhostedcse@gmail.com';
  data[0].value=username;

  // data[1].value='unhostedcse@gmail.com,unhostedcse@outlook.com';
  // data[2].value='unhostedcse,unhostedcse';

  // username='unhostedcse@gmail.com';
  // password='rusasuergi@150';
  // // alert('password');
  // smtphost="smtp.gmail.com";
  // smtpport=465;
  // smtpsecurity='ssl';
  
  var sync=new Sync_Module(f);
  sync.initSMTP();

  $(document).on("click",'#send_button',
    function(e) {
      // alert('send'+e);

        try{
        var text=document.getElementById('composeMessage').value;
        var subject=document.getElementById('subject').value;
        var data=document.getElementsByClassName('hordeACTrigger impACTrigger');

        var to=data[0].value;
        var cc=data[1].value;
        var bcc=data[2].value;

        // console.log(text);
        console.log(to);
        console.log(cc);
        console.log(bcc);
        console.log(subject);


        // $.event.trigger({type:"composeMail"});

        start(to,cc,bcc,subject,text);
        

      }catch(e){
        console.log(e);
      }
    }
);  

function start(to,cc,bcc,subject,text){ 
  // mailto='unhostedcse@outlook.com';
  mailto=to.split(",");

  if(cc)
    var mailcc=cc.split(",");

  if(bcc)
    var mailbcc=bcc.split(",");

  // var u1='unhostedcse@gmail.com';
  // var u2='unhostedcse@gmail.com';
  var to="To: ";
  for(var i=0;i<mailto.length;i++){
    to+=mailto[i]+' <'+mailto[i]+'>,';
  }

  if(mailcc){
    var cc="CC: ";
    for(var i=0;i<mailcc.length;i++){
      cc+='"'+mailcc[i]+'" <'+mailcc[i]+'>,';
      mailto.push(mailcc[i]);
    }
  }  

  if(mailbcc)
    for(var i=0;i<mailbcc.length;i++){
      mailto.push(mailbcc[i]);
    }  

  var date=(new Date()).toUTCString();

  // body= 'From: '+username+' <'+username+'>'+'\r\n'+  
  //       to+'\r\n'+
  //       'Subject: '+subject+'\r\n'+
  //       'Date: '+date+'\r\n'+        
  //       cc+'\r\n'+        
  //       '\r\n'+
  //       text;

var head=""+
"MIME-Version: 1.0"+"\r\n"+
"x-no-auto-attachment: 1"+"\r\n"+
//"Received: by 10.60.41.195; Wed, 10 Sep 2014 00:24:10 -0700 (PDT)"+"\r\n"+
"Date: "+date+"\r\n"+
// "Message-ID: <CAEbMfJLbWOV2OohyRZ2ibvXEBhJjryt1XsDa=xC-C6wRnTu9pw@mail.gmail.com>"+"\r\n"+
"Subject: "+subject+"\r\n"+
'From: '+username+' <'+username+'>'+'\r\n'+  
to+'\r\n'+
//"To: unhosted cse <unhostedcse@gmail.com>"+"\r\n"+
"Content-Type: multipart/alternative; boundary=089e01293fa625798e0502b0f0ce"+"\r\n";

body=head+'\r\n'+text;

  sync.SendMail();
  saveSendMail(to,cc,bcc,subject,text);

}

function f(){
  console.log('Starting SMTP...');
}

// call when send button click
function saveSendMail(to,cc,bcc,subject,text){

  text='Subject: '+subject+'\r\n'+text;
  sync.db.saveSendMail(text,to,cc,bcc);
}

//send mail when new mail is waiting
$(document).on("newSendMail", 
  function(e){
    console.log(e.type);
    try{
      Sync_Module.db.getSaveSendMail();
    }catch(e){
      console.log(e);
    }
  }
);

function setForwardComposeMail(){

}

function setReplyComposeMail(){

}

 </script> 


<div style="position: fixed; padding: 10px; z-index: 50000; display: none; bottom: 0px; right: 0px;" id="Growler"></div>
<iframe style="display: none;" src="javascript:false" name="submit_frame"></iframe>
<div style="display: none;" class="KeyNavList"><ul><li>High</li><li class="selected">Normal</li><li>Low</li></ul></div></body></html>
